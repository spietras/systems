version: "3.43"

tasks:
  template:
    desc: Fetch template updates
    interactive: true
    env:
      GIT_CONFIG_GLOBAL: ""
      GIT_CONFIG_SYSTEM: ""
    cmds:
      - >-
        copier
        update
        --answers-file
        .copier-answers.yaml
        {{ .CLI_ARGS }}
  flake:
    desc: Update flake.lock
    cmds:
      - >-
        nix
        --accept-flake-config
        --extra-experimental-features
        'nix-command flakes'
        --no-warn-dirty
        flake
        update
        {{ .CLI_ARGS }}
  fmt:
    desc: Format files
    cmds:
      - >-
        trunk
        fmt
        {{ .CLI_ARGS }}
  lint:
    desc: Lint files
    cmds:
      - >-
        trunk
        check
        {{ .CLI_ARGS }}
  clean:
    desc: Clean build outputs
    cmds:
      - >-
        rm
        --force
        {{ .CLI_ARGS }}
        build
    status:
      - >-
        test
        '!'
        -e
        build
  build:
    desc: Build a target
    cmds:
      - >-
        ./scripts/build.sh
        {{ .CLI_ARGS }}
  run:
    desc: Run a target
    interactive: true
    cmds:
      - >-
        ./scripts/run.sh
        {{ .CLI_ARGS }}
  vm:
    desc: Run a virtual machine
    interactive: true
    cmds:
      - >-
        ./scripts/vm.sh
        {{ .CLI_ARGS }}
  install:
    desc: Install system on current machine
    cmds:
      - >-
        ./scripts/install.sh
        {{ .CLI_ARGS }}
  secret:
    desc: Edit secrets
    interactive: true
    cmds:
      - >-
        sops
        {{ .CLI_ARGS }}
